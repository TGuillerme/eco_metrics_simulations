---
title: "Measuring metric effect"
author: "Thomas Guillerme (guillert@tcd.ie)"
date: "`r Sys.Date()`"
bibliography: [../References.bib, ../packages.bib]
output:
  html_document: default
  pdf_document: default
---

This is a demo on how to measure the effect of the different stressors from `01_Simulating_spaces_and_stressors.Rmd` on some of our metrics of interest.
This could be done easily using the `dispRity` package.
Here's a simple example.

```{r}
library(dispRity)
library(dads)
library(BAT)
```

## Simulations

Here I'm going to create a wrapping function that simulates the space, apply the stressors and output them into a `"dispRity"` object:

```{r}
## Function for simplifying the plots
#' @param elements the total of elements (before reduction)
#' @param remove the proportion of elements to remove
#' @param stressors the list of stressors as algorithms from dispRity::reduce.space
## Simulating one space 
sim.data <- function(elements, remove, stressors) {
    ## Simulate the data (no stressors)
    evol_data <- dads(stop.rule = list(max.living = elements),
                      bd.params = list(speciation = 1),
                      traits    = make.traits())
    tip_data <- evol_data$data[evol_data$tree$tip.label, , drop = FALSE]
    ## Non evo algorithm (if needed)
    # tip_data <- space.maker(elements = elements, dimensions = 1, distribution = rnorm)
    # rownames(tip_data) <- 1:elements
    ## Apply all the stressors
    stressed_data <- list()
    for(stress in 1:length(stressors)) {
        stressed_data[[stress]] <- reduce.space(tip_data,
                                            remove = remove,
                                            type = stressors[[stress]])
    }
    ## Modify the list to only get the IDs of the selected elements
    names(stressed_data) <- stressors
    stressed_data <- lapply(stressed_data, function(x, data) rownames(data)[which(x)], data = tip_data)

    ## Create the dispRity object
    return(custom.subsets(tip_data, group = stressed_data))
}
```

Here's an example how it works for 10 replicates:

```{r}
## Generating a set of 50 simulations
simulations <- replicate(10, sim.data(elements = 200, remove = 0.5,
                                       stressors = c("random",
                                                     "size",
                                                     "evenness",
                                                     "position",
                                                     "density")),
                          simplify = FALSE)
```


## Metrics
